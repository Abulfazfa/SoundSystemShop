<section style="margin: 113px;">
    <h2>Create Your Product</h2>
    <div class="selectedArea" style="margin: 20px 0;">
        <ul id="selectedList">
            <li data-li="frame"></li>
            <li data-li="horn"></li>
            <li data-li="subwoofer"></li>
            <li data-li="more"></li>
            <li class="totalPrice"></li>
            <button id="createButton">Create</button>
        </ul>
    </div>
    <button class="productButton" data-category="Frame">Frame</button>
    <button class="productButton" data-category="Horn">Horn</button>
    <button class="productButton" data-category="Subwoofer">Subwoofer</button>
    <button class="productButton" data-category="More">More</button>
    <div class="row area">
    </div>
</section>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        var totalPrice = 0; // Initialize total price to 0
        var totalPriceElement = $(".totalPrice"); // Reference to the Total Price element
        var allButtons = $(".productButton");
        var area = $(".area");
        var selectedList = $("#selectedList");
        var selectedCategory = null; // To keep track of selected category

        function updateTotalPrice() {
            totalPriceElement.text(`Total Price: $${totalPrice.toFixed(2)}`);
        }

        function clearSelected() {
            selectedCategory = null;
            area.empty();
            allButtons.removeClass("selected");
        }

        allButtons.click(function () {
            var button = $(this);
            var buttonId = button.data("category");

            if (buttonId === selectedCategory) {
                clearSelected();
                return;
            }

            clearSelected();
            button.addClass("selected");
            selectedCategory = buttonId;

            $.ajax({
                url: `https://localhost:44392/shop/GetCategoryProduct?categoryName=${buttonId}`,
                success: function (results) {
                    results.forEach(function (result) {
                        var product = `
                                            <div class="col-md-3">
                                                <div class="card mt-5">
                                                    <div class="card-body">
                                                        <div class="form-group">
                                                            <img src="/assets/img/product/${result.images[0].imgUrl}" width="150" height="100" />
                                                        </div>
                                                        <div class="form-group">
                                                            <p>${result.name}</p>
                                                            <span>$${result.price}</span>
                                                        </div>
                                                        <a class="btn btn-primary selectButton text-light">Select</a>
                                                    </div>
                                                </div>
                                            </div>
                                        `;

                        area.append(product);
                    });

                    $(".selectButton").click(function () {
                        var productPrice = parseFloat($(this).siblings(".form-group").find("span").text().replace("$", ""));
                        totalPrice += productPrice; // Update the total price
                        updateTotalPrice(); // Update the displayed total price

                        var productName = $(this).siblings(".form-group").find("p").text();
                        var productPriceFormatted = $(this).siblings(".form-group").find("span").text();
                        var categoryName = selectedCategory.toLowerCase();
                        var listItem = selectedList.find(`li[data-li="${categoryName}"]`);
                        listItem.html(`${productName} (${categoryName}) - ${productPriceFormatted} <button class="deleteButton">Delete</button>`);
                    });

                    selectedList.on("click", ".deleteButton", function () {
                        var listItem = $(this).parent();
                        var productPriceFormatted = listItem.find("span").text();
                        var productPrice = parseFloat(productPriceFormatted.replace("$", ""));
                        totalPrice -= productPrice; // Update the total price
                        updateTotalPrice(); // Update the displayed total price

                        listItem.html('');
                    });
                },
                error: function (xhr, status, error) {
                    console.error("AJAX request failed:", status, error);
                }
            });
        });

        $("#createButton").click(function () {
            var emptyElements = selectedList.find("li").filter(function () {
                return $(this).text().trim() === "";
            });

            if (emptyElements.length > 0) {
                alert("Please fill in all categories before creating.");
            } else {
                
            }
        });
    });


</script>

<style>
    /* Add some styles for the selected button */
    .selected {
        background-color: #007bff;
        color: #fff;
    }
    li {
        padding: 10px 0;
    }
    ul {
        list-style: none;
    }
</style>
